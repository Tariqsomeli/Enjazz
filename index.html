<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø¥Ù†Ø¬Ø§Ø²ÙŠ">
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù…Ø¹ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ">
    <meta name="theme-color" content="#6366f1">
    <meta name="background-color" content="#020617">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .drag-ghost { opacity: 0.5; transform: scale(1.02); }
        .category-dot { width: 8px; height: 8px; border-radius: 50%; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-slideUp { animation: slideUp 0.3s ease-out; }
        .animate-pulse { animation: pulse 2s infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        .shake { animation: shake 0.5s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes typing { 0% { width: 0 } 100% { width: 100% } }
        .typing-effect { overflow: hidden; white-space: nowrap; animation: typing 2s steps(40); }
        .category-work { background: #3b82f6; }
        .category-personal { background: #10b981; }
        .category-health { background: #f59e0b; }
        .category-study { background: #8b5cf6; }
        .category-other { background: #6b7280; }
        .phase-1 { border-right: 4px solid #3b82f6; }
        .phase-2 { border-right: 4px solid #10b981; }
        .phase-3 { border-right: 4px solid #f59e0b; }
        .phase-4 { border-right: 4px solid #8b5cf6; }
        .phase-5 { border-right: 4px solid #ec4899; }
    </style>
</head>
<body class="bg-slate-950 text-white overflow-hidden transition-colors duration-300">
    <div id="app" class="h-[100dvh] flex flex-col"></div>

    <script>
        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙˆØ§Ù„ØªØµÙ†ÙŠÙØ§Øª ---
        const CATEGORIES = [
            { id: 'work', name: 'Ø¹Ù…Ù„', color: 'blue', icon: 'ğŸ’¼' },
            { id: 'personal', name: 'Ø´Ø®ØµÙŠ', color: 'green', icon: 'ğŸ ' },
            { id: 'health', name: 'ØµØ­Ø©', color: 'amber', icon: 'ğŸƒ' },
            { id: 'study', name: 'Ø¯Ø±Ø§Ø³Ø©', color: 'violet', icon: 'ğŸ“š' },
            { id: 'other', name: 'Ø£Ø®Ø±Ù‰', color: 'gray', icon: 'ğŸ“Œ' }
        ];

        const DAYS = ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];

        const PHASES = [
            { id: 1, name: 'Ø§Ù„ØªØ®Ø·ÙŠØ·', icon: 'ğŸ“‹', color: 'blue', duration: '1-3 Ø£ÙŠØ§Ù…' },
            { id: 2, name: 'Ø§Ù„Ø¨Ø¯Ø¡', icon: 'ğŸš€', color: 'green', duration: '3-7 Ø£ÙŠØ§Ù…' },
            { id: 3, name: 'Ø§Ù„ØªÙ†ÙÙŠØ°', icon: 'âš¡', color: 'amber', duration: '1-4 Ø£Ø³Ø§Ø¨ÙŠØ¹' },
            { id: 4, name: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', icon: 'ğŸ”', color: 'violet', duration: '2-5 Ø£ÙŠØ§Ù…' },
            { id: 5, name: 'Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', icon: 'ğŸ¯', color: 'pink', duration: '1-3 Ø£ÙŠØ§Ù…' }
        ];

        const PRIORITIES = [
            { id: 'high', name: 'Ø¹Ø§Ù„ÙŠØ©', color: 'red', icon: 'ğŸ”´' },
            { id: 'medium', name: 'Ù…ØªÙˆØ³Ø·Ø©', color: 'amber', icon: 'ğŸŸ¡' },
            { id: 'low', name: 'Ù…Ù†Ø®ÙØ¶Ø©', color: 'green', icon: 'ğŸŸ¢' }
        ];

        let state = {
            activeTab: 'tasks',
            settingsTab: 'general',
            isDarkMode: true,
            showAddTask: false,
            showAddIdea: false,
            showSettings: false,
            showCategoryPicker: false,
            showAIPanel: false,
            showWorkPlan: false,
            selectedIdea: null,
            editingTask: null,
            selectedCategory: 'work',
            selectedPriority: 'medium',
            expandedDay: new Date().getDay() + 1,
            tasks: JSON.parse(localStorage.getItem('enjaaz_tasks') || '[]'),
            ideas: JSON.parse(localStorage.getItem('enjaaz_ideas') || '[]'),
            workPlans: JSON.parse(localStorage.getItem('enjaaz_workplans') || '[]'),
            completedHistory: JSON.parse(localStorage.getItem('enjaaz_history') || '{}'),
            settings: JSON.parse(localStorage.getItem('enjaaz_settings') || '{"notifications": true, "reminderTime": "09:00", "startDay": 6, "apiKey": ""}'),
            newTaskText: '',
            newTaskNote: '',
            newTaskDate: '',
            newTaskRepeat: 'none',
            newTaskPriority: 'medium',
            newIdeaText: '',
            aiPrompt: '',
            aiResponse: '',
            isGenerating: false,
            generatedPlan: null
        };

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† ---
        function save() {
            localStorage.setItem('enjaaz_tasks', JSON.stringify(state.tasks));
            localStorage.setItem('enjaaz_ideas', JSON.stringify(state.ideas));
            localStorage.setItem('enjaaz_workplans', JSON.stringify(state.workPlans));
            localStorage.setItem('enjaaz_history', JSON.stringify(state.completedHistory));
            localStorage.setItem('enjaaz_settings', JSON.stringify(state.settings));
        }

        function getTodayString() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ---
        function calculateStats() {
            const today = getTodayString();
            const weekTasks = state.tasks.filter(t => {
                const taskDate = new Date(t.createdAt);
                const now = new Date();
                const weekAgo = new Date(now.setDate(now.getDate() - 7));
                return taskDate >= weekAgo;
            });

            const todayCompleted = state.completedHistory[today] || 0;
            const weekCompleted = Object.values(state.completedHistory).reduce((a, b) => a + b, 0);

            const completedTasks = state.tasks.filter(t => t.completed);
            const streak = calculateStreak();

            return {
                total: state.tasks.length,
                completed: completedTasks.length,
                pending: state.tasks.length - completedTasks.length,
                todayCompleted,
                weekCompleted,
                streak,
                completionRate: state.tasks.length ? Math.round((completedTasks.length / state.tasks.length) * 100) : 0
            };
        }

        function calculateStreak() {
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                if ((state.completedHistory[dateStr] || 0) > 0) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            return streak;
        }

        function getWeekDays() {
            const days = [];
            const today = new Date();
            const dayOfWeek = today.getDay();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - dayOfWeek + (state.settings.startDay || 6));

            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                days.push({
                    date,
                    dateStr: date.toISOString().split('T')[0],
                    name: DAYS[i]
                });
            }
            return days;
        }

        function getDailyProgress(dateStr) {
            const dayTasks = state.tasks.filter(t => {
                const taskDate = t.createdAt.split('T')[0];
                return taskDate === dateStr;
            });
            if (dayTasks.length === 0) return 0;
            return Math.round((dayTasks.filter(t => t.completed).length / dayTasks.length) * 100);
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… ---
        function addTask() {
            if (!state.newTaskText.trim()) return;
            
            const task = {
                id: Date.now(),
                text: state.newTaskText,
                note: state.newTaskNote,
                category: state.selectedCategory,
                completed: false,
                repeat: state.newTaskRepeat,
                priority: state.newTaskPriority,
                createdAt: new Date().toISOString(),
                dayId: state.expandedDay,
                order: state.tasks.filter(t => t.dayId === state.expandedDay).length
            };

            state.tasks.push(task);
            save();
            
            state.newTaskText = '';
            state.newTaskNote = '';
            state.newTaskRepeat = 'none';
            state.newTaskPriority = 'medium';
            state.showAddTask = false;
            render();
        }

        function toggleTask(id) {
            const task = state.tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                
                if (task.completed) {
                    const today = getTodayString();
                    state.completedHistory[today] = (state.completedHistory[today] || 0) + 1;
                }
                
                save();
                render();
            }
        }

        function deleteTask(id) {
            const task = state.tasks.find(t => t.id === id);
            if (task && task.completed && task.createdAt.startsWith(getTodayString())) {
                const today = getTodayString();
                state.completedHistory[today] = Math.max(0, (state.completedHistory[today] || 1) - 1);
            }
            state.tasks = state.tasks.filter(t => t.id !== id);
            save();
            render();
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£ÙÙƒØ§Ø± ---
        function addIdea() {
            if (!state.newIdeaText.trim()) return;
            
            state.ideas.unshift({
                id: Date.now(),
                text: state.newIdeaText,
                category: state.selectedCategory,
                createdAt: new Date().toISOString(),
                hasPlan: false
            });
            
            save();
            state.newIdeaText = '';
            render();
        }

        function deleteIdea(id) {
            state.ideas = state.ideas.filter(i => i.id !== id);
            state.workPlans = state.workPlans.filter(p => p.ideaId !== id);
            save();
            render();
        }

        function openIdeaDetails(idea) {
            state.selectedIdea = idea;
            state.showAIPanel = true;
            state.aiPrompt = '';
            state.aiResponse = '';
            state.generatedPlan = null;
            render();
        }

        function openIdeaById(id) {
            const idea = state.ideas.find(i => i.id === id);
            if (idea) {
                openIdeaDetails(idea);
            }
        }

        function openWorkPlanById(id) {
            const plan = state.workPlans.find(p => p.id === id);
            if (plan) {
                state.generatedPlan = plan;
                state.showWorkPlan = true;
                render();
            }
        }

        function openWorkPlan(plan) {
            state.generatedPlan = plan;
            state.showWorkPlan = true;
            render();
        }

        // --- Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ---
        async function generateAIContent(prompt, idea) {
            state.isGenerating = true;
            state.aiResponse = '';
            render();

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            const responses = {
                analysis: `
## ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙƒØ±Ø©

### Ø§Ù„ÙˆØµÙ Ø§Ù„Ø£ØµÙ„ÙŠ
"${idea.text}"

### Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©
- ÙÙƒØ±Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø­Ø¯Ø¯Ø©
- Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ° ÙÙŠ Ø¥Ø·Ø§Ø± Ø²Ù…Ù†ÙŠ Ù…Ø­Ø¯Ø¯
- ØªØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø£Ù‡Ø¯Ø§Ù ${CATEGORIES.find(c => c.id === idea.category)?.name || 'Ø§Ù„Ù…Ø´Ø±ÙˆØ¹'}

### Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
- Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ ØªØ®ØµÙŠØµ ÙˆÙ‚Øª ÙƒØ§ÙÙ Ù„Ù„ØªÙ†ÙÙŠØ°
- Ù‚Ø¯ ØªØªØ·Ù„Ø¨ Ù…ÙˆØ§Ø±Ø¯ Ø®Ø§Ø±Ø¬ÙŠØ©
- Ø£Ù‡Ù…ÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨ÙˆØ¶ÙˆØ­

### ÙØ±Øµ Ø§Ù„ØªØ·ÙˆÙŠØ±
- Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªÙˆØ³Ø¹ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹
- Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø£Ù‡Ø¯Ø§Ù Ø£ÙƒØ¨Ø±
- ØªÙˆØ¸ÙŠÙ Ù…Ù‡Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
                `,
                plan: `
## ğŸ“‹ Ø®Ø·Ø© Ø¹Ù…Ù„ Ù…Ù‚ØªØ±Ø­Ø©

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„ØªØ®Ø·ÙŠØ· (Ø§Ù„ÙŠÙˆÙ… 1-2)
- â¬œ ØªØ­Ø¯ÙŠØ¯ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙÙƒØ±Ø© Ø¨ÙˆØ¶ÙˆØ­
- â¬œ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©
- â¬œ Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
- â¬œ ÙˆØ¶Ø¹ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ Ù…Ø¨Ø¯Ø¦ÙŠ

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„ØªØ­Ø¶ÙŠØ± (Ø§Ù„ÙŠÙˆÙ… 3-4)
- â¬œ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯
- â¬œ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø¹Ù…Ù„
- â¬œ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„ØªÙ†ÙÙŠØ° (Ø§Ù„ÙŠÙˆÙ… 5-10)
- â¬œ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
- â¬œ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù… ÙŠÙˆÙ…ÙŠØ§Ù‹
- â¬œ Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø£ÙˆÙ„

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©: Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Ø§Ù„ÙŠÙˆÙ… 11-12)
- â¬œ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©
- â¬œ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
- â¬œ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©: Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (Ø§Ù„ÙŠÙˆÙ… 13-14)
- â¬œ Ø§Ù„Ø§Ø­ØªÙØ§Ø¡ Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­
- â¬œ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
- â¬œ Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                `,
                improvements: `
## ğŸ’¡ Ø£ÙÙƒØ§Ø± ØªØ·ÙˆÙŠØ± Ø§Ù„ÙÙƒØ±Ø©

### 1. Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±
ÙŠÙ…ÙƒÙ† Ø¯Ù…Ø¬ Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÙŠØ¯Ø© ØªØ¬Ø°Ø¨ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ ÙˆØªØªÙ…ÙŠØ² Ø¨Ù‡Ø§ Ø§Ù„ÙÙƒØ±Ø© Ø¹Ù† ØºÙŠØ±Ù‡Ø§

### 2. ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©
ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø§Ù„ØªÙŠ ÙŠÙ‚Ø¯Ù…Ù‡Ø§ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†

### 3. Ø®Ø·Ø© Ø§Ù„ØªØ³ÙˆÙŠÙ‚
ÙˆØ¶Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„ØªØ±ÙˆÙŠØ¬ ÙˆØ¥ÙŠØµØ§Ù„ Ø§Ù„ÙÙƒØ±Ø© Ù„Ù„Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù

### 4. Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡
ØªØ­Ø¯ÙŠØ¯ Ù…Ø¤Ø´Ø±Ø§Øª Ø£Ø¯Ø§Ø¡ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³ Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø¬Ø§Ø­

### 5. Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ©
ÙˆØ¶Ø¹ Ø®Ø·Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„ÙÙƒØ±Ø© ÙˆØªØ·ÙˆØ±Ù‡Ø§
                `,
                timeline: `
## ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù…Ù‚ØªØ±Ø­

### Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¨Ù†Ø§Ø¡
- **Ø§Ù„ÙŠÙˆÙ… 1-2**: Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ø±Ø¤ÙŠØ©
- **Ø§Ù„ÙŠÙˆÙ… 3-4**: Ø§Ù„ØªØ­Ø¶ÙŠØ± ÙˆØ§Ù„ØªØ¬Ù‡ÙŠØ²
- **Ø§Ù„ÙŠÙˆÙ… 5-7**: Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°

### Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„ØªØ·ÙˆÙŠØ±
- **Ø§Ù„ÙŠÙˆÙ… 8-10**: Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«
- **Ø§Ù„ÙŠÙˆÙ… 11-12**: Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†
- **Ø§Ù„ÙŠÙˆÙ… 13-14**: Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©

### Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©
- Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: 14 ÙŠÙˆÙ…
- Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©: Ø´Ø®Øµ ÙˆØ§Ø­Ø¯
- Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©: ØµÙØ± - Ù…Ù†Ø®ÙØ¶Ø©

### Ø§Ù„Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
- âœ“ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
- âœ“ Ù…Ù†ØªØµÙ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ù†Ø³Ø®Ø© Ø£ÙˆÙ„ÙŠØ©
- âœ“ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¥Ø·Ù„Ø§Ù‚ ÙƒØ§Ù…Ù„
                `
            };

            const responseKey = prompt.toLowerCase().includes('Ø®Ø·Ø©') ? 'plan' : 
                               prompt.toLowerCase().includes('ØªØ·ÙˆÙŠØ±') ? 'improvements' :
                               prompt.toLowerCase().includes('Ø¬Ø¯ÙˆÙ„') ? 'timeline' : 'analysis';

            const response = responses[responseKey] || responses.analysis;
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠØ©
            const lines = response.split('\n');
            for (const line of lines) {
                await new Promise(resolve => setTimeout(resolve, 100));
                state.aiResponse += line + '\n';
                render();
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„
                const content = document.getElementById('aiResponseContent');
                if (content) content.scrollTop = content.scrollHeight;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø°Ù„Ùƒ
            if (prompt.toLowerCase().includes('Ø®Ø·Ø©')) {
                state.generatedPlan = {
                    id: Date.now(),
                    ideaId: idea.id,
                    ideaText: idea.text,
                    category: idea.category,
                    phases: [
                        { id: 1, name: 'Ø§Ù„ØªØ®Ø·ÙŠØ·', tasks: ['ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù', 'Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯'], completed: false },
                        { id: 2, name: 'Ø§Ù„Ø¨Ø¯Ø¡', tasks: ['ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø¯ÙˆØ§Øª', 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ¦Ø©', 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø­Ù„'], completed: false },
                        { id: 3, name: 'Ø§Ù„ØªÙ†ÙÙŠØ°', tasks: ['ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø±Ø§Ø­Ù„', 'Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©', 'Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª'], completed: false },
                        { id: 4, name: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', tasks: ['ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬', 'Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù', 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¯Ø±ÙˆØ³'], completed: false },
                        { id: 5, name: 'Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', tasks: ['Ø§Ù„Ø§Ø­ØªÙØ§Ø¡ Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­', 'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬', 'Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„'], completed: false }
                    ],
                    createdAt: new Date().toISOString(),
                    totalTasks: 15,
                    completedTasks: 0
                };
                render();
            }

            state.isGenerating = false;
            render();
        }

        function addPlanToTasks(plan) {
            // Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ù…Ù‡Ø§Ù… Ø§Ù„Ø®Ø·Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
            let taskId = Date.now();
            plan.phases.forEach((phase, phaseIndex) => {
                phase.tasks.forEach((taskText, taskIndex) => {
                    state.tasks.push({
                        id: taskId++,
                        text: `[${plan.ideaText.substring(0, 20)}...] - ${taskText}`,
                        note: `Ù…Ø±Ø­Ù„Ø©: ${phase.name}`,
                        category: plan.category,
                        completed: false,
                        repeat: 'none',
                        priority: 'medium',
                        createdAt: new Date().toISOString(),
                        dayId: (state.expandedDay + phaseIndex) % 7,
                        order: taskIndex,
                        isPlanTask: true,
                        planId: plan.id
                    });
                });
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙƒØ±Ø© Ù„ØªØ´ÙŠØ± Ø£Ù†Ù‡Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®Ø·Ø©
            const idea = state.ideas.find(i => i.id === plan.ideaId);
            if (idea) idea.hasPlan = true;

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø·Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
            if (!state.workPlans.find(p => p.id === plan.id)) {
                state.workPlans.push(plan);
            }

            save();
            state.showWorkPlan = false;
            render();
            
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ù…Ù‡Ø§Ù… Ø§Ù„Ø®Ø·Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…!');
        }

        // --- Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ù…Ø¸Ù‡Ø± ---
        function setTab(tab) {
            state.activeTab = tab;
            state.showAddTask = false;
            state.showAddIdea = false;
            state.editingTask = null;
            state.showAIPanel = false;
            state.showWorkPlan = false;
            render();
        }

        function setSettingsTab(tab) {
            state.settingsTab = tab;
            render();
        }

        function toggleTheme() {
            state.isDarkMode = !state.isDarkMode;
            save();
            render();
        }

        function toggleDay(id) {
            state.expandedDay = state.expandedDay === id ? null : id;
            render();
        }

        function selectCategory(categoryId) {
            state.selectedCategory = categoryId;
            state.showCategoryPicker = false;
            render();
        }

        function selectPriority(priorityId) {
            state.selectedPriority = priorityId;
            render();
        }

        // --- Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ---
        function exportData() {
            const data = {
                tasks: state.tasks,
                ideas: state.ideas,
                workPlans: state.workPlans,
                completedHistory: state.completedHistory,
                settings: state.settings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `enjaaz-backup-${getTodayString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.tasks) state.tasks = data.tasks;
                    if (data.ideas) state.ideas = data.ideas;
                    if (data.workPlans) state.workPlans = data.workPlans;
                    if (data.completedHistory) state.completedHistory = data.completedHistory;
                    if (data.settings) state.settings = { ...state.settings, ...data.settings };
                    save();
                    render();
                } catch (err) {
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            };
            reader.readAsText(file);
        }

        // --- Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ---
        function render() {
            const app = document.getElementById('app');
            const stats = calculateStats();
            const themeClass = state.isDarkMode ? 'bg-slate-950 text-white' : 'bg-slate-50 text-slate-900';
            const cardClass = state.isDarkMode ? 'bg-slate-900/50 border-slate-800' : 'bg-white border-slate-200 shadow-sm';
            const headerClass = state.isDarkMode ? 'bg-slate-950/80 border-slate-900' : 'bg-white/80 border-slate-200';
            const inputClass = state.isDarkMode ? 'bg-slate-800/50 border-slate-700 text-white' : 'bg-slate-100 border-slate-200 text-slate-900';
            const mutedClass = state.isDarkMode ? 'text-slate-400' : 'text-slate-500';

            document.body.className = themeClass;

            app.innerHTML = `
                <!-- Header -->
                <header class="sticky top-0 z-40 px-6 pt-12 pb-4 backdrop-blur-md border-b ${headerClass} safe-top transition-colors duration-300">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-3">
                            <h1 class="text-2xl font-black">${state.activeTab === 'tasks' ? 'Ø¥Ù†Ø¬Ø§Ø²ÙŠ' : state.activeTab === 'ideas' ? 'Ø£ÙÙƒØ§Ø±ÙŠ' : 'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª'}</h1>
                            ${state.activeTab === 'tasks' ? `<span class="bg-indigo-500/20 text-indigo-500 text-xs px-2 py-1 rounded-full font-bold">${stats.completionRate}%</span>` : ''}
                        </div>
                        <div class="flex items-center gap-2">
                            ${state.activeTab === 'tasks' ? `
                                <button onclick="toggleDay(state.expandedDay)" class="p-2 rounded-xl ${state.isDarkMode ? 'bg-slate-800 text-indigo-400' : 'bg-slate-200 text-indigo-600'}">
                                    ğŸ“…
                                </button>
                            ` : ''}
                            <button onclick="state.showSettings = true; render()" class="p-2 rounded-xl ${state.isDarkMode ? 'bg-slate-800 text-slate-400' : 'bg-slate-200 text-slate-500'}">
                                âš™ï¸
                            </button>
                            <button onclick="toggleTheme()" class="p-2 rounded-xl ${state.isDarkMode ? 'bg-slate-800 text-yellow-400' : 'bg-slate-200 text-slate-500'}">
                                ${state.isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™'}
                            </button>
                        </div>
                    </div>
                    ${state.activeTab === 'tasks' ? renderProgressBar(stats) : ''}
                </header>

                <!-- Main Content -->
                <main class="flex-1 overflow-y-auto px-6 pt-4 pb-32 no-scrollbar">
                    ${state.activeTab === 'tasks' ? renderTasks(cardClass, inputClass, mutedClass) : 
                      state.activeTab === 'ideas' ? renderIdeas(cardClass, inputClass, mutedClass) : 
                      renderStats(stats, cardClass, inputClass, mutedClass)}
                </main>

                <!-- Add Task Modal -->
                ${state.showAddTask ? renderAddTaskModal(inputClass) : ''}
                ${state.editingTask ? renderEditTaskModal(inputClass) : ''}

                <!-- Add Idea Modal -->
                ${state.showAddIdea ? renderAddIdeaModal(inputClass) : ''}

                <!-- AI Panel Modal -->
                ${state.showAIPanel && state.selectedIdea ? renderAIPanel(inputClass, mutedClass) : ''}

                <!-- Work Plan Modal -->
                ${state.showWorkPlan && state.generatedPlan ? renderWorkPlanModal(cardClass, mutedClass) : ''}

                <!-- Settings Modal -->
                ${state.showSettings ? renderSettingsModal(cardClass, inputClass, mutedClass) : ''}

                <!-- Category Picker -->
                ${state.showCategoryPicker ? renderCategoryPicker() : ''}

                <!-- Priority Picker -->
                ${state.showPriorityPicker ? renderPriorityPicker() : ''}

                <!-- Bottom Navigation -->
                <nav class="fixed bottom-0 inset-x-0 px-8 pt-4 pb-10 flex justify-around items-center border-t backdrop-blur-xl ${headerClass} safe-bottom transition-colors duration-300">
                    <button onclick="setTab('tasks')" class="flex flex-col items-center gap-1 ${state.activeTab === 'tasks' ? 'text-indigo-500' : 'text-slate-500'}">
                        <span class="text-2xl">ğŸ“</span><span class="text-[10px] font-bold">Ù…Ù‡Ø§Ù…ÙŠ</span>
                    </button>
                    <button onclick="setTab('stats')" class="flex flex-col items-center gap-1 ${state.activeTab === 'stats' ? 'text-indigo-500' : 'text-slate-500'}">
                        <span class="text-2xl">ğŸ“Š</span><span class="text-[10px] font-bold">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
                    </button>
                    <button onclick="setTab('ideas')" class="flex flex-col items-center gap-1 ${state.activeTab === 'ideas' ? 'text-indigo-500' : 'text-slate-500'}">
                        <span class="text-2xl">ğŸ’¡</span><span class="text-[10px] font-bold">Ø£ÙÙƒØ§Ø±ÙŠ</span>
                    </button>
                </nav>
            `;

            // Initialize chart if on stats tab
            if (state.activeTab === 'stats' && !document.getElementById('progressChart')) {
                setTimeout(initChart, 100);
            }
        }

        function renderProgressBar(stats) {
            return `
                <div class="flex justify-between text-[10px] font-bold text-indigo-500 mb-1">
                    <span>Ø§Ù„ØªÙ‚Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span>
                    <span>${stats.completed}/${stats.total}</span>
                </div>
                <div class="h-2 w-full ${state.isDarkMode ? 'bg-slate-800' : 'bg-slate-200'} rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-indigo-500 to-violet-500 transition-all duration-500" style="width: ${stats.completionRate}%"></div>
                </div>
            `;
        }

        function renderTasks(cardClass, inputClass, mutedClass) {
            return DAYS.map((name, id) => {
                const dayTasks = state.tasks.filter(t => t.dayId === id).sort((a, b) => a.order - b.order);
                const isExpanded = state.expandedDay === id;

                return `
                    <div class="mb-3 rounded-[2rem] border ${isExpanded ? 'bg-indigo-600/5 border-indigo-500/30' : cardClass} transition-all duration-300">
                        <button onclick="toggleDay(${id})" class="w-full p-5 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-2xl flex items-center justify-center font-bold text-sm ${isExpanded ? 'bg-indigo-600 text-white' : 'bg-slate-800 text-slate-500'}">
                                    ${isExpanded ? 'ğŸ“…' : name[0]}
                                </div>
                                <div class="text-right">
                                    <span class="font-bold block">${name}</span>
                                    <span class="text-xs ${mutedClass}">${dayTasks.filter(t => t.completed).length}/${dayTasks.length} Ù…ÙƒØªÙ…Ù„Ø©</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                ${dayTasks.length > 0 ? `
                                    <div class="w-12 h-12 relative">
                                        <svg class="w-full h-full transform -rotate-90">
                                            <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="4" fill="none" class="${state.isDarkMode ? 'text-slate-700' : 'text-slate-200'}"/>
                                            <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="4" fill="none" 
                                                stroke-dasharray="${125}" stroke-dashoffset="${125 - (125 * (dayTasks.length ? dayTasks.filter(t => t.completed).length / dayTasks.length : 0))}"
                                                class="${isExpanded ? 'text-indigo-500' : 'text-emerald-500'}"/>
                                        </svg>
                                    </div>
                                ` : ''}
                                <span class="text-lg ${isExpanded ? 'rotate-180' : ''} transition-transform duration-300">â–²</span>
                            </div>
                        </button>
                        ${isExpanded ? `
                            <div class="px-5 pb-5 space-y-3 animate-slideUp">
                                ${dayTasks.length === 0 ? `
                                    <div class="text-center py-8 ${mutedClass}">
                                        <span class="text-4xl mb-2 block">âœ¨</span>
                                        <span class="text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</span>
                                    </div>
                                ` : dayTasks.map(t => renderTaskItem(t, mutedClass)).join('')}
                                
                                <div class="flex gap-2 pt-2">
                                    <button onclick="state.showAddTask = true; state.expandedDay = ${id}; state.newTaskText = ''; state.newTaskNote = ''; state.newTaskRepeat = 'none'; render()" class="flex-1 bg-slate-800/50 text-slate-400 py-3 rounded-2xl text-sm font-bold flex items-center justify-center gap-2">
                                        <span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderTaskItem(task, mutedClass) {
            const priority = PRIORITIES.find(p => p.id === task.priority);
            return `
                <div class="group flex items-center gap-3 p-4 ${state.isDarkMode ? 'bg-slate-800/30' : 'bg-slate-100'} rounded-2xl hover:bg-indigo-500/10 transition-all duration-200">
                    <button onclick="toggleTask(${task.id})" class="w-7 h-7 rounded-lg border-2 flex items-center justify-center transition-all duration-200 ${task.completed ? 'bg-green-500 border-green-500 scale-110' : 'border-slate-600 hover:border-indigo-500'}">
                        ${task.completed ? '<span class="text-white text-xs font-bold">âœ“</span>' : ''}
                    </button>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <span class="text-xs">${priority?.icon || ''}</span>
                            <span class="category-dot category-${task.category}"></span>
                            <span class="flex-1 text-sm truncate ${task.completed ? 'line-through ' + mutedClass : ''}">${task.text}</span>
                        </div>
                        ${task.note ? `<p class="text-xs ${mutedClass} mt-1 truncate">${task.note}</p>` : ''}
                        ${task.repeat !== 'none' ? `<span class="text-xs text-amber-500 mt-1">ğŸ”„ ${task.repeat === 'daily' ? 'ÙŠÙˆÙ…ÙŠØ§Ù‹' : task.repeat === 'weekly' ? 'Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹' : 'Ø´Ù‡Ø±ÙŠØ§Ù‹'}</span>` : ''}
                        ${task.isPlanTask ? `<span class="text-xs text-indigo-500 mt-1">ğŸ“‹ Ù…Ù† Ø®Ø·Ø© Ø¹Ù…Ù„</span>` : ''}
                    </div>
                    <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="deleteTask(${task.id})" class="p-2 rounded-lg ${state.isDarkMode ? 'bg-slate-700' : 'bg-slate-200'} text-sm">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `;
        }

        function renderAddTaskModal(inputClass) {
            return `
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-end justify-center safe-bottom" onclick="state.showAddTask = false; render()">
                    <div class="w-full max-w-md bg-slate-900 rounded-t-[2rem] p-6 animate-slideUp" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                            <button onclick="state.showAddTask = false; render()" class="p-2 bg-slate-800 rounded-full">âœ•</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold mb-2 text-slate-400">Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                                <input type="text" id="taskTextInput" value="${state.newTaskText}" oninput="state.newTaskText = this.value" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø¥Ù†Ø¬Ø§Ø²Ù‡ØŸ" class="w-full ${inputClass} rounded-2xl px-4 py-4 text-sm outline-none focus:border-indigo-500 transition-colors">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-2 text-slate-400">Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                <textarea id="taskNoteInput" oninput="state.newTaskNote = this.value" placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..." class="w-full ${inputClass} rounded-2xl px-4 py-3 text-sm outline-none focus:border-indigo-500 resize-none h-24"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-2 text-slate-400">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                                <button onclick="state.showCategoryPicker = true; render()" class="w-full ${inputClass} rounded-2xl px-4 py-3 text-sm flex items-center justify-between">
                                    <span class="flex items-center gap-2">
                                        <span class="category-dot category-${state.selectedCategory}"></span>
                                        ${CATEGORIES.find(c => c.id === state.selectedCategory)?.name}
                                    </span>
                                    <span>â–¼</span>
                                </button>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-2 text-slate-400">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                                <button onclick="state.showPriorityPicker = true; render()" class="w-full ${inputClass} rounded-2xl px-4 py-3 text-sm flex items-center justify-between">
                                    <span class="flex items-center gap-2">
                                        ${PRIORITIES.find(p => p.id === state.newTaskPriority)?.icon}
                                        ${PRIORITIES.find(p => p.id === state.newTaskPriority)?.name}
                                    </span>
                                    <span>â–¼</span>
                                </button>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-2 text-slate-400">Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
                                <select onchange="state.newTaskRepeat = this.value" class="w-full ${inputClass} rounded-2xl px-4 py-3 text-sm outline-none appearance-none cursor-pointer">
                                    <option value="none" ${state.newTaskRepeat === 'none' ? 'selected' : ''}>Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±</option>
                                    <option value="daily" ${state.newTaskRepeat === 'daily' ? 'selected' : ''}>ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                                    <option value="weekly" ${state.newTaskRepeat === 'weekly' ? 'selected' : ''}>Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</option>
                                    <option value="monthly" ${state.newTaskRepeat === 'monthly' ? 'selected' : ''}>Ø´Ù‡Ø±ÙŠØ§Ù‹</option>
                                </select>
                            </div>
                            
                            <button onclick="addTask()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/25">
                                Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPriorityPicker() {
            return `
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="state.showPriorityPicker = false; render()">
                    <div class="w-full max-w-sm bg-slate-900 rounded-[2rem] p-6 animate-slideUp" onclick="event.stopPropagation()">
                        <h3 class="text-xl font-bold mb-6 text-center">Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</h3>
                        <div class="space-y-3">
                            ${PRIORITIES.map(p => `
                                <button onclick="state.newTaskPriority = '${p.id}'; state.showPriorityPicker = false; render()" class="w-full p-4 rounded-2xl flex items-center gap-4 ${state.newTaskPriority === p.id ? 'bg-indigo-600' : 'bg-slate-800'} transition-colors">
                                    <span class="text-2xl">${p.icon}</span>
                                    <span class="font-bold">${p.name}</span>
                                </button>
                            `).join('')}
                        </div>
                        <button onclick="state.showPriorityPicker = false; render()" class="w-full mt-6 py-3 rounded-2xl ${state.isDarkMode ? 'bg-slate-800' : 'bg-slate-200'} font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
        }

        function renderCategoryPicker() {
            return `
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="state.showCategoryPicker = false; render()">
                    <div class="w-full max-w-sm bg-slate-900 rounded-[2rem] p-6 animate-slideUp" onclick="event.stopPropagation()">
                        <h3 class="text-xl font-bold mb-6 text-center">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</h3>
                        <div class="space-y-3">
                            ${CATEGORIES.map(c => `
                                <button onclick="selectCategory('${c.id}')" class="w-full p-4 rounded-2xl flex items-center gap-4 ${state.selectedCategory === c.id ? 'bg-indigo-600' : 'bg-slate-800'} transition-colors">
                                    <span class="text-2xl">${c.icon}</span>
                                    <span class="category-dot category-${c.id}"></span>
                                    <span class="font-bold">${c.name}</span>
                                </button>
                            `).join('')}
                        </div>
                        <button onclick="state.showCategoryPicker = false; render()" class="w-full mt-6 py-3 rounded-2xl ${state.isDarkMode ? 'bg-slate-800' : 'bg-slate-200'} font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
        }

        function renderIdeas(cardClass, inputClass, mutedClass) {
            return `
                <div class="space-y-4">
                    <button onclick="state.showAddIdea = true; state.newIdeaText = ''; render()" class="w-full bg-gradient-to-r from-indigo-600 to-violet-600 p-6 rounded-[2rem] text-white shadow-lg shadow-indigo-500/25">
                        <span class="text-4xl mb-2 block">ğŸ’¡</span>
                        <span class="font-bold text-lg">Ø£Ø¶Ù ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                        <p class="text-sm opacity-80 mt-1">Ø³Ø¬Ù‘Ù„ Ø£ÙÙƒØ§Ø±Ùƒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§</p>
                    </button>
                    
                    ${state.ideas.length === 0 ? `
                        <div class="text-center py-16 ${mutedClass}">
                            <span class="text-6xl mb-4 block">ğŸ“</span>
                            <span class="text-lg font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø¨Ø¹Ø¯</span>
                            <p class="text-sm mt-2">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø£ÙÙƒØ§Ø±Ùƒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ</p>
                        </div>
                    ` : state.ideas.map(i => `
                        <div class="${cardClass} p-6 rounded-[2rem] border border-indigo-500/10">
                            <div class="flex items-start gap-4">
                                <button onclick="openIdeaById(${i.id})" class="text-3xl mt-1 hover:scale-110 transition-transform cursor-pointer">ğŸ’¡</button>
                                <div class="flex-1">
                                    <p class="text-md leading-relaxed">${i.text}</p>
                                    <div class="flex justify-between items-center mt-4">
                                        <div class="flex items-center gap-3">
                                            <span class="category-dot category-${i.category || 'other'}"></span>
                                            <span class="text-xs ${mutedClass}">${new Date(i.createdAt).toLocaleDateString('ar-SA')}</span>
                                            ${i.hasPlan ? '<span class="text-xs bg-green-500/20 text-green-500 px-2 py-1 rounded-full">ğŸ“‹ Ø®Ø·Ø© Ø¹Ù…Ù„</span>' : ''}
                                        </div>
                                        <button onclick="deleteIdea(${i.id})" class="text-red-500 text-sm px-3 py-1 rounded-full bg-red-500/10">Ø­Ø°Ù</button>
                                    </div>
                                    ${i.hasPlan ? `
                                        <div class="mt-3">
                                            ${state.workPlans.filter(p => p.ideaId === i.id).map(p => `
                                                <button onclick="openWorkPlanById(${p.id})" class="w-full mt-2 py-2 rounded-xl bg-indigo-500/20 text-indigo-400 text-sm font-bold">
                                                    ğŸ“Š Ø¹Ø±Ø¶ Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ (${p.completedTasks}/${p.totalTasks} Ù…Ù‡Ø§Ù…)
                                                </button>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderAddIdeaModal(inputClass) {
            return `
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-end justify-center safe-bottom" onclick="state.showAddIdea = false; render()">
                    <div class="w-full max-w-md bg-slate-900 rounded-t-[2rem] p-6 animate-slideUp" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                            <button onclick="state.showAddIdea = false; render()" class="p-2 bg-slate-800 rounded-full">âœ•</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold mb-2 text-slate-400">ÙÙƒØ±ØªÙƒ</label>
                                <textarea id="ideaText" oninput="state.newIdeaText = this.value" placeholder="Ù…Ø§Ø°Ø§ ÙŠØ¯ÙˆØ± ÙÙŠ Ø°Ù‡Ù†ÙƒØŸ" class="w-full ${inputClass} rounded-2xl px-4 py-4 text-sm outline-none focus:border-indigo-500 resize-none h-40"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-2 text-slate-400">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                                <button onclick="state.showCategoryPicker = true; render()" class="w-full ${inputClass} rounded-2xl px-4 py-3 text-sm flex items-center justify-between">
                                    <span class="flex items-center gap-2">
                                        <span class="category-dot category-${state.selectedCategory}"></span>
                                        ${CATEGORIES.find(c => c.id === state.selectedCategory)?.name}
                                    </span>
                                    <span>â–¼</span>
                                </button>
                            </div>
                            
                            <button onclick="addIdea()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-indigo-700 shadow-lg shadow-indigo-500/25">
                                Ø­ÙØ¸ Ø§Ù„ÙÙƒØ±Ø©
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAIPanel(inputClass, mutedClass) {
            if (!state.selectedIdea) return '';
            
            return `
                <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end justify-center safe-bottom" onclick="state.showAIPanel = false; render()">
                    <div class="w-full max-w-2xl bg-slate-900 rounded-t-[2rem] p-6 animate-slideUp max-h-[85vh] overflow-hidden flex flex-col" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold flex items-center gap-3">
                                <span class="text-2xl">ğŸ¤–</span>
                                Ù…Ø³Ø§Ø¹Ø¯ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£ÙÙƒØ§Ø±
                            </h3>
                            <button onclick="state.showAIPanel = false; render()" class="p-2 bg-slate-800 rounded-full">âœ•</button>
                        </div>
                        
                        <!-- Idea Preview -->
                        <div class="p-4 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 mb-4">
                            <p class="text-sm font-bold text-indigo-400 mb-2">Ø§Ù„ÙÙƒØ±Ø©:</p>
                            <p class="text-md leading-relaxed">${state.selectedIdea.text}</p>
                        </div>
                        
                        <!-- AI Prompts -->
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <button onclick="generateAIContent('Ø­Ù„Ù„ Ù‡Ø°Ù‡ Ø§Ù„ÙÙƒØ±Ø©', state.selectedIdea)" ${state.isGenerating ? 'disabled' : ''} class="p-3 rounded-xl bg-blue-500/20 text-blue-400 text-sm font-bold hover:bg-blue-500/30 transition-colors">
                                ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙƒØ±Ø©
                            </button>
                            <button onclick="generateAIContent('Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© Ø¹Ù…Ù„ ÙƒØ§Ù…Ù„Ø©', state.selectedIdea)" ${state.isGenerating ? 'disabled' : ''} class="p-3 rounded-xl bg-green-500/20 text-green-400 text-sm font-bold hover:bg-green-500/30 transition-colors">
                                ğŸ“‹ Ø®Ø·Ø© Ø¹Ù…Ù„
                            </button>
                            <button onclick="generateAIContent('Ù‚Ø¯Ù… Ø£ÙÙƒØ§Ø± Ù„Ù„ØªØ·ÙˆÙŠØ±', state.selectedIdea)" ${state.isGenerating ? 'disabled' : ''} class="p-3 rounded-xl bg-amber-500/20 text-amber-400 text-sm font-bold hover:bg-amber-500/30 transition-colors">
                                ğŸ’¡ ØªØ·ÙˆÙŠØ± Ø§Ù„ÙÙƒØ±Ø©
                            </button>
                            <button onclick="generateAIContent('Ø£Ù†Ø´Ø¦ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ', state.selectedIdea)" ${state.isGenerating ? 'disabled' : ''} class="p-3 rounded-xl bg-violet-500/20 text-violet-400 text-sm font-bold hover:bg-violet-500/30 transition-colors">
                                ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ
                            </button>
                        </div>
                        
                        <!-- AI Response -->
                        <div class="flex-1 overflow-hidden flex flex-col">
                            <div id="aiResponseContent" class="flex-1 overflow-y-auto p-4 rounded-2xl ${state.isDarkMode ? 'bg-slate-800' : 'bg-slate-100'} text-sm leading-relaxed whitespace-pre-wrap ${mutedClass}">
                                ${state.isGenerating ? `
                                    <div class="flex items-center gap-3">
                                        <span class="animate-spin text-2xl">â³</span>
                                        <span class="typing-effect">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ ÙÙƒØ±ØªÙƒ...</span>
                                    </div>
                                ` : state.aiResponse || 'Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø£Ø¹Ù„Ø§Ù‡ Ù„ØªØ·ÙˆÙŠØ± ÙÙƒØ±ØªÙƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ'}
                            </div>
                        </div>
                        
                        ${state.generatedPlan ? `
                            <div class="mt-4 flex gap-3">
                                <button onclick="state.workPlans.push(state.generatedPlan); save(); alert('âœ… ØªÙ… Ø­ÙØ¸ Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„!');" class="flex-1 py-3 rounded-2xl bg-green-600 text-white font-bold hover:bg-green-700 transition-colors">
                                    ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø©
                                </button>
                                <button onclick="addPlanToTasks(state.generatedPlan);" class="flex-1 py-3 rounded-2xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-colors">
                                    â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù‡Ø§Ù…
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderWorkPlanModal(cardClass, mutedClass) {
            if (!state.generatedPlan) return '';
            
            const progress = Math.round((state.generatedPlan.completedTasks / state.generatedPlan.totalTasks) * 100);
            
            return `
                <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end justify-center safe-bottom" onclick="state.showWorkPlan = false; render()">
                    <div class="w-full max-w-2xl bg-slate-900 rounded-t-[2rem] p-6 animate-slideUp max-h-[85vh] overflow-hidden flex flex-col" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold flex items-center gap-3">
                                <span class="text-2xl">ğŸ“‹</span>
                                Ø®Ø·Ø© Ø¹Ù…Ù„
                            </h3>
                            <button onclick="state.showWorkPlan = false; render()" class="p-2 bg-slate-800 rounded-full">âœ•</button>
                        </div>
                        
                        <!-- Plan Header -->
                        <div class="p-4 rounded-2xl bg-gradient-to-r from-indigo-500/20 to-violet-500/20 border border-indigo-500/30 mb-4">
                            <p class="text-sm font-bold text-indigo-400 mb-2">${state.generatedPlan.ideaText}</p>
                            <div class="flex items-center gap-4 mt-3">
                                <div class="flex-1">
                                    <div class="flex justify-between text-xs mb-1">
                                        <span class="${mutedClass}">Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                                        <span class="text-indigo-400">${progress}%</span>
                                    </div>
                                    <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                                        <div class="h-full bg-indigo-500 transition-all duration-500" style="width: ${progress}%"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <span class="text-2xl font-black text-indigo-400">${state.generatedPlan.completedTasks}/${state.generatedPlan.totalTasks}</span>
                                    <p class="text-xs ${mutedClass}">Ù…Ù‡Ø§Ù…</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Phases -->
                        <div class="flex-1 overflow-y-auto space-y-4 no-scrollbar">
                            ${state.generatedPlan.phases.map((phase, index) => `
                                <div class="p-4 rounded-2xl ${state.isDarkMode ? 'bg-slate-800/50' : 'bg-slate-100'} phase-${index + 1}">
                                    <div class="flex items-center gap-3 mb-3">
                                        <span class="text-2xl">${PHASES[index]?.icon || 'ğŸ“Œ'}</span>
                                        <div>
                                            <h4 class="font-bold">${phase.name}</h4>
                                            <p class="text-xs ${mutedClass}">${PHASES[index]?.duration || '2-3 Ø£ÙŠØ§Ù…'}</p>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        ${phase.tasks.map((task, taskIndex) => `
                                            <div class="flex items-center gap-3 p-2 rounded-xl ${state.isDarkMode ? 'bg-slate-900' : 'bg-white'}">
                                                <button onclick="togglePlanTask(${index}, ${taskIndex})" class="w-5 h-5 rounded border-2 ${phase.completed ? 'bg-green-500 border-green-500' : 'border-slate-600'}">
                                                    ${phase.completed ? '<span class="text-white text-xs">âœ“</span>' : ''}
                                                </button>
                                                <span class="flex-1 text-sm ${phase.completed ? 'line-through ' + mutedClass : ''}">${task}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Actions -->
                        <div class="mt-4 flex gap-3">
                            <button onclick="addPlanToTasks(state.generatedPlan)" class="flex-1 py-3 rounded-2xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-colors">
                                â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù‡Ø§Ù…
                            </button>
                            <button onclick="state.showWorkPlan = false; render()" class="px-6 py-3 rounded-2xl ${state.isDarkMode ? 'bg-slate-800' : 'bg-slate-200'} font-bold">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function togglePlanTask(phaseIndex, taskIndex) {
            const plan = state.generatedPlan;
            if (plan && plan.phases[phaseIndex]) {
                // ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ù‡Ø§Ù…
                const wasCompleted = plan.phases[phaseIndex].completed;
                plan.phases[phaseIndex].completed = !wasCompleted;
                plan.completedTasks = plan.phases.reduce((sum, p) => sum + (p.completed ? p.tasks.length : 0), 0);
                
                // Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø©
                const existingIndex = state.workPlans.findIndex(p => p.id === plan.id);
                if (existingIndex >= 0) {
                    state.workPlans[existingIndex] = plan;
                } else {
                    state.workPlans.push(plan);
                }
                
                save();
                render();
            }
        }

        function renderStats(stats, cardClass, inputClass, mutedClass) {
            const weekDays = getWeekDays();
            const progressData = weekDays.map(d => getDailyProgress(d.dateStr));

            return `
                <div class="space-y-6">
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="${cardClass} p-5 rounded-[2rem] text-center">
                            <span class="text-4xl mb-2 block">ğŸ”¥</span>
                            <span class="text-3xl font-black text-orange-500">${stats.streak}</span>
                            <p class="text-xs ${mutedClass} mt-1">Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©</p>
                        </div>
                        <div class="${cardClass} p-5 rounded-[2rem] text-center">
                            <span class="text-4xl mb-2 block">âœ…</span>
                            <span class="text-3xl font-black text-green-500">${stats.todayCompleted}</span>
                            <p class="text-xs ${mutedClass} mt-1">Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                        <div class="${cardClass} p-5 rounded-[2rem] text-center">
                            <span class="text-4xl mb-2 block">ğŸ“…</span>
                            <span class="text-3xl font-black text-indigo-500">${stats.weekCompleted}</span>
                            <p class="text-xs ${mutedClass} mt-1">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
                        </div>
                        <div class="${cardClass} p-5 rounded-[2rem] text-center">
                            <span class="text-4xl mb-2 block">â³</span>
                            <span class="text-3xl font-black text-amber-500">${stats.pending}</span>
                            <p class="text-xs ${mutedClass} mt-1">Ù…ØªØ¨Ù‚ÙŠØ©</p>
                        </div>
                    </div>

                    <!-- Progress Chart -->
                    <div class="${cardClass} p-6 rounded-[2rem]">
                        <h3 class="font-bold mb-4">ØªÙ‚Ø¯Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
                        <canvas id="progressChart" class="w-full h-48"></canvas>
                    </div>

                    <!-- Category Breakdown -->
                    <div class="${cardClass} p-6 rounded-[2rem]">
                        <h3 class="font-bold mb-4">Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</h3>
                        <div class="space-y-3">
                            ${CATEGORIES.map(c => {
                                const catTasks = state.tasks.filter(t => t.category === c.id);
                                const catCompleted = catTasks.filter(t => t.completed).length;
                                const percentage = catTasks.length ? Math.round((catCompleted / catTasks.length) * 100) : 0;
                                return `
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="flex items-center gap-2">
                                                <span class="category-dot category-${c.id}"></span>
                                                ${c.name}
                                            </span>
                                            <span class="${mutedClass}">${catCompleted}/${catTasks.length}</span>
                                        </div>
                                        <div class="h-2 ${state.isDarkMode ? 'bg-slate-800' : 'bg-slate-200'} rounded-full overflow-hidden">
                                            <div class="h-full category-${c.id} transition-all duration-500" style="width: ${percentage}%"></div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Weekly Progress -->
                    <div class="${cardClass} p-6 rounded-[2rem]">
                        <h3 class="font-bold mb-4">ÙŠÙˆÙ…ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
                        <div class="flex justify-between">
                            ${weekDays.map((d, i) => {
                                const progress = getDailyProgress(d.dateStr);
                                const isToday = d.dateStr === getTodayString();
                                return `
                                    <div class="text-center">
                                        <div class="w-12 h-12 rounded-2xl flex items-center justify-center mb-2 ${isToday ? 'bg-indigo-600 text-white' : state.isDarkMode ? 'bg-slate-800' : 'bg-slate-200'}">
                                            <span class="text-lg font-bold">${progress}%</span>
                                        </div>
                                        <span class="text-xs ${mutedClass}">${d.name}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSettingsModal(cardClass, inputClass, mutedClass) {
            return `
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-end justify-center safe-bottom" onclick="state.showSettings = false; render()">
                    <div class="w-full max-w-md bg-slate-900 rounded-t-[2rem] p-6 animate-slideUp max-h-[85vh] overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                            <button onclick="state.showSettings = false; render()" class="p-2 bg-slate-800 rounded-full">âœ•</button>
                        </div>
                        
                        <!-- Settings Tabs -->
                        <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                            ${['general', 'backup', 'about'].map(tab => `
                                <button onclick="setSettingsTab('${tab}')" class="px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap ${state.settingsTab === tab ? 'bg-indigo-600 text-white' : 'bg-slate-800 text-slate-400'}">
                                    ${tab === 'general' ? 'âš™ï¸ Ø¹Ø§Ù…' : tab === 'backup' ? 'ğŸ’¾ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©' : 'â„¹ï¸ Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'}
                                </button>
                            `).join('')}
                        </div>
                        
                        ${state.settingsTab === 'general' ? `
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-bold mb-3">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</label>
                                    <button onclick="state.settings.notifications = !state.settings.notifications; save(); render()" class="w-full p-4 rounded-2xl flex items-center justify-between ${inputClass}">
                                        <span class="flex items-center gap-3">
                                            <span class="text-xl">ğŸ””</span>
                                            <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
                                        </span>
                                        <span class="w-12 h-6 rounded-full ${state.settings.notifications ? 'bg-green-500' : 'bg-slate-600'} relative transition-colors">
                                            <span class="absolute w-5 h-5 bg-white rounded-full top-0.5 ${state.settings.notifications ? 'left-6.5' : 'left-0.5'} transition-all"></span>
                                        </span>
                                    </button>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3">ÙˆÙ‚Øª Ø§Ù„ØªØ°ÙƒÙŠØ±</label>
                                    <input type="time" value="${state.settings.reminderTime || '09:00'}" onchange="state.settings.reminderTime = this.value; save()" class="w-full ${inputClass} rounded-2xl px-4 py-3 text-sm outline-none">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3">ÙŠÙˆÙ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                                    <select onchange="state.settings.startDay = parseInt(this.value); save(); render()" class="w-full ${inputClass} rounded-2xl px-4 py-3 text-sm outline-none appearance-none cursor-pointer">
                                        ${DAYS.map((d, i) => `<option value="${i}" ${(state.settings.startDay || 6) === i ? 'selected' : ''}>${d}</option>`).join('')}
                                    </select>
                                </div>
                                
                                <button onclick="state.tasks = []; state.ideas = []; state.workPlans = []; state.completedHistory = {}; save(); render(); state.showSettings = false;" class="w-full py-4 rounded-2xl bg-red-600 text-white font-bold">
                                    ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                </button>
                            </div>
                        ` : state.settingsTab === 'backup' ? `
                            <div class="space-y-4">
                                <button onclick="exportData()" class="w-full p-5 rounded-2xl ${inputClass} flex items-center justify-between">
                                    <span class="flex items-center gap-3">
                                        <span class="text-2xl">ğŸ“¤</span>
                                        <span class="font-bold">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                                    </span>
                                    <span>â¬‡ï¸</span>
                                </button>
                                
                                <label class="w-full p-5 rounded-2xl ${inputClass} flex items-center justify-between cursor-pointer">
                                    <span class="flex items-center gap-3">
                                        <span class="text-2xl">ğŸ“¥</span>
                                        <span class="font-bold">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                                    </span>
                                    <input type="file" accept=".json" onchange="importData(this.files[0])" class="hidden">
                                    <span>â¬†ï¸</span>
                                </label>
                                
                                <div class="p-4 rounded-2xl ${state.isDarkMode ? 'bg-slate-800' : 'bg-slate-200'}">
                                    <p class="text-xs ${mutedClass}">Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${localStorage.getItem('enjaaz_lastBackup') || 'Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø©'}</p>
                                </div>
                            </div>
                        ` : `
                            <div class="text-center space-y-4">
                                <div class="text-6xl">ğŸ“±</div>
                                <h2 class="text-2xl font-black">Ø¥Ù†Ø¬Ø§Ø²ÙŠ</h2>
                                <p class="text-sm ${mutedClass}">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.5.0</p>
                                <p class="text-sm leading-relaxed ${mutedClass}>
                                    ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ<br>
                                    Ù…Ø¹ Ù…ÙŠØ²Ø© ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                                </p>
                                <div class="flex justify-center gap-4 mt-6">
                                    <a href="#" class="text-indigo-500 text-sm">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
                                    <a href="#" class="text-indigo-500 text-sm">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</a>
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function initChart() {
            const ctx = document.getElementById('progressChart');
            if (!ctx) return;

            const weekDays = getWeekDays();
            const progressData = weekDays.map(d => getDailyProgress(d.dateStr));

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weekDays.map(d => d.name),
                    datasets: [{
                        label: 'Ø§Ù„ØªÙ‚Ø¯Ù…',
                        data: progressData,
                        backgroundColor: 'rgba(99, 102, 241, 0.5)',
                        borderColor: 'rgb(99, 102, 241)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        // Initialize
        render();
        
        // Request notification permission if enabled
        if (state.settings.notifications && 'Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
